<template>
  <div class="page">
    <div class="navbar color-theme-red">
      <div class="navbar-inner">
        <div class="left">
          <a href="#" class="link panel-open" data-panel="left">
            <i class="icon f7-icons if-ios">menu</i>
            <i class="icon material-icons if-md">menu</i>
          </a>
        </div>
        <div class="center">
          <span>Reporte de ingreso-salida del MTC</span> AVP
        </div>
      </div>
    </div>
    <div class="page-content">
      <div class="block">
        <div class="row">
          <a class="link" href="/menu/">
            <i class="material-icons">
              assignment_return
            </i>
            <span>Regresar al menú principal</span>
          </a>
        </div>

        <form class="list">
          <div class="block-title">PROFESIONAL</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">DNI</div>
                  <div class="item-input-wrap">
                    <input id="dni" name="dni" type="text" placeholder="Ingrese el DNI">
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Nombre</div>
                  <div class="item-input-wrap">
                    <input id="nombre" name="nombre" type="text" placeholder="Ingrese el nombre">
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">HORARIO DE INGRESO AL MTC (hacia destino)</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Hora de Ingreso</div>
                  <div class="item-input-wrap input-dropdown-wrap">
                    <select id="ingresohora" name="ingresohora" placeholder="Seleccione la hora...">
                    </select>
                  </div>
                </div>
                <div class="item-inner">
                  <div class="item-title item-label">Minuto de Ingreso</div>
                  <div class="item-input-wrap input-dropdown-wrap">
                    <select id="ingresominuto" name="ingresominuto" placeholder="Seleccione el minuto...">
                    </select>
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">HORARIO DE SALIDA DEL MTC (regreso de campo)</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Hora de Salida</div>
                  <div class="item-input-wrap input-dropdown-wrap">
                    <select id="salidahora" name="salidahora" placeholder="Seleccione la hora...">
                    </select>
                  </div>
                </div>
                <div class="item-inner">
                  <div class="item-title item-label">Minuto de Salida</div>
                  <div class="item-input-wrap input-dropdown-wrap">
                    <select id="salidaminuto" name="salidaminuto" placeholder="Seleccione el minuto...">
                    </select>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        
          <div class="block-title">MOVILIDAD</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Nombre del conductor</div>
                  <div class="item-input-wrap">
                    <input id="nombreconductor" name="nombreconductor" type="text" placeholder="Ingrese el nombre del conductor">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Placa del vehículo</div>
                  <div class="item-input-wrap">
                    <input id="placavehiculo" name="placavehiculo" type="text" placeholder="Ingrese la placa del vehículo">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">DESTINO</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-input-wrap">
                    <input id="destino" name="destino" type="text" placeholder="Ingrese el destino">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">OBJETO DE SALIDA</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-input-wrap">
                    <input id="objetosalida" name="objetosalida" type="text" placeholder="Ingrese la finalidad de la salida">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        
        </form>
        <div class="list" style="padding: 20px;">
          <ul>
            <li>
              <a id="btnregistrar" @click="registraringreso" class="col button button-raised button-fill button-round">Registrar ingreso</a>
            </li>
          </ul>
          <div class="block-footer">
  
          </div>
        </div>

      </div>
    </div>

  </div>
</template>
<script>
  import './css/mapa.css';
  import $ from "jquery";
  import {objectToString, StringToObject} from '../../helper'
  import {servers} from "../Login/servers";


  export default {
    created() {

    },
    on: {
      pageInit: function (event, page) {
        // llenar Horas
        for(var i = 0; i <= 23; i++) {
          var option = document.createElement('option');
          var option2 = document.createElement('option');
          option.textContent = (i < 10) ? ("0" + i) : i;
          option2.textContent = (i < 10) ? ("0" + i) : i;
          document.querySelector('#ingresohora').appendChild(option);
          document.querySelector('#salidahora').appendChild(option2);
          
        }
        // llenar Minutos
        for(var i = 0; i <= 59; i++) {
          var option = document.createElement('option');
          var option2 = document.createElement('option');
          option.textContent = (i < 10) ? ("0" + i) : i;
          option2.textContent = (i < 10) ? ("0" + i) : i;
          document.querySelector('#ingresominuto').appendChild(option);
          document.querySelector('#salidaminuto').appendChild(option2);
        }

        let config;

        if(localStorage.usuariopersonal != undefined){
          config = JSON.parse(localStorage.usuariopersonal);
          $('#dni').val(config[0].dni);
          $('#nombre').val(config[0].nombres_apellidos);
        }
      }
    },

    methods: {
      registraringreso() {

        const app = this.$app;
        const router = this.$router;
        
        let datos = {profesionaprofesionalombres:`${$('#nombre').val()}`,
                    dni:`${$('#dni').val()}`,
                    hora_ingreso:`${$('#ingresohora').val() + ':' + $('#ingresominuto').val()}`,
                    hora_salida:`${$('#salidahora').val() + ':' + $('#salidaminuto').val()}`,
                    nombre_conductor:`${$('#nombreconductor').val()}`,
                    placa:`${$('#placavehiculo').val()}`,
                    destino:`${$('#destino').val()}`,
                    objeto_salida:`${$('#objetosalida').val()}`,
                    lat:``,
                    lon:``
                    };

        let url_server = `http://${servers[2].ipServidor}:${servers[2].puertoServidor}/api`;

        $.post(`${url_server}/ingreso`, datos, function(data) { 
          if ($.isEmptyObject(data))
          {
            app.dialog.alert("Se encontró problema al registrar el ingreso.");
          }
          else
          {
            let txtMensaje = `Su reporte de ingreso ${data.id} fue enviado con éxito.`
            app.dialog.alert(txtMensaje, function () {
              router.navigate('/menu/', {pushState: true});
            });
          }
        })
        .fail(function() {
          app.dialog.alert( "Se encontró un problema en la conexión." );
        })
        .always(function() {
          
        });

      },
    }


  }
</script>