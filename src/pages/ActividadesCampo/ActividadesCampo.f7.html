<template>
  <div class="page">
    <div class="navbar color-theme-red">
      <div class="navbar-inner">
        <div class="left">
          <a href="#" class="link panel-open" data-panel="left">
            <i class="icon f7-icons if-ios">menu</i>
            <i class="icon material-icons if-md">menu</i>
          </a>
        </div>
        <div class="center">

          <!--a className='flex-parent-inline btn color-blue color-white-on-active bg-transparent bg-darken10-on-hover bg-blue-on-active txt-s ml3'
            href='#'-->
            <span>Reporte de actividad en campo</span> AVP
          <!--/a-->
        </div>


      </div>
    </div>
    <div class="page-content">
      <div class="block">
        <div class="row">
          <a class="link" href="/menu/">
            <i class="material-icons">
              assignment_return
            </i>
            <span>Regresar al menú principal</span>
          </a>
        </div>

        <form class="list">
          <div class="block-title">PROFESIONAL</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">DNI</div>
                  <div class="item-input-wrap">
                    <input id="dni" name="dni" type="text" placeholder="Ingrese el DNI">
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Nombre</div>
                  <div class="item-input-wrap">
                    <input id="nombre" name="nombre" type="text" placeholder="Ingrese el nombre">
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">GRUPO DE TRABAJO</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <!--div class="item-title item-label">Vía</div-->
                  <div class="item-input-wrap input-dropdown-wrap">
                    <select id="grupo_trabajo" name="grupo_trabajo" placeholder="Seleccione el grupo...">
                      <option value="Inteferencias">Inteferencias</option>
                      <option value="Otros">Otros</option>
                    </select>
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">FECHA</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <!--div class="item-title item-label">Vía</div-->
                  <div class="item-input-wrap">
                    <input id="fecha" name="fecha" type="date" value="2014-04-30" placeholder="Seleccione una fecha...">
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">HORARIO DE ACTIVIDADES EN ÁREA SE ESTUDIO</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Hora de Inicio de Actividades</div>
                  <div class="item-input-wrap input-dropdown-wrap">
                    <select id="inicioacthora" name="inicioacthora" placeholder="Seleccione la hora...">
                    </select>
                  </div>
                </div>
                <div class="item-inner">
                  <div class="item-title item-label">Minuto de Inicio de Actividades</div>
                  <div class="item-input-wrap input-dropdown-wrap">
                    <select id="inicioactminuto" name="inicioactminuto" placeholder="Seleccione el minuto...">
                    </select>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Hora de Fin de Actividades</div>
                  <div class="item-input-wrap input-dropdown-wrap">
                    <select id="finacthora" name="finacthora" placeholder="Seleccione la hora...">
                    </select>
                  </div>
                </div>
                <div class="item-inner">
                  <div class="item-title item-label">Minuto de Fin de Actividades</div>
                  <div class="item-input-wrap input-dropdown-wrap">
                    <select id="finactminuto" name="finactminuto" placeholder="Seleccione el minuto...">
                    </select>
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">ÁREA DE ESTUDIO / TRABAJO</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Tramo</div>
                  <div class="item-input-wrap">
                    <input id="tramo" name="tramo" type="text" placeholder="Ingrese el tramo">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Sector</div>
                  <div class="item-input-wrap">
                    <input id="sector" name="sector" type="text" placeholder="Ingrese el sector">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Vía</div>
                  <div class="item-input-wrap input-dropdown-wrap">
                    <select id="tipovia" name="tipovia" placeholder="Seleccione la vía...">
                      <option value="AV">AV</option>
                      <option value="CA">CA</option>
                      <option value="JR">JR</option>
                    </select>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Nombre</div>
                  <div class="item-input-wrap">
                    <input id="nombrecalle" name="nombrecalle" type="text" placeholder="Ingrese el Nombre de la calle / vía / jirón">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Cuadras</div>
                  <div class="item-input-wrap">
                    <input id="cuadras" name="cuadras" type="text" placeholder="Ingrese las cuadras">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Referencia</div>
                  <div class="item-input-wrap">
                    <input id="referencia" name="referencia" type="text" placeholder="Ingrese la referencia">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">ACTIVIDAD</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Tipo</div>
                  <div class="item-inpuct-wrap input-dropdown-wrap">
                    <select id="tipoactividad" name="tipoactividad" placeholder="Seleccione el tipo de actividad...">
                      <option value="LEVANTAMIENTO">LEVANTAMIENTO</option>
                      <option value="VERIFICACIÓN">VERIFICACIÓN</option>
                      <option value="REPLANTEO">REPLANTEO</option>
                      <option value="ACTUALIZACIÓN">ACTUALIZACIÓN</option>
                      <option value="VALORIZACIÓN">VALORIZACIÓN</option>
                      <option value="COORDINACIÓN">COORDINACIÓN</option>
                      <option value="OTROS">OTROS</option>
                    </select>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Detalle</div>
                  <div class="item-input-wrap">
                    <input id="detalleact" name="detalleact" type="text" placeholder="Ingrese el detalle">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">EQUIPO UTILIZADO</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Equipo</div>
                  <div class="item-inpuct-wrap input-dropdown-wrap">
                    <select id="equipo" name="equipo" placeholder="Seleccione el equipo utilizado">
                      <option value="EST TOTAL">EST TOTAL</option>
                      <option value="GPS">GPS</option>
                      <option value="WINCHA">WINCHA</option>
                      <option value="OTROS">OTROS</option>
                    </select>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Especificar</div>
                  <div class="item-input-wrap">
                    <input id="especificar" name="especificar" type="text" placeholder="Especifique el equipo">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block-title">COORDINACIONES</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Tipo</div>
                  <div class="item-inpuct-wrap input-dropdown-wrap">
                    <select id="tipocoordinacion" name="tipocoordinacion" placeholder="Seleccione el tipo de coordinación...">
                      <option value="FUNCIONARIOS">FUNCIONARIOS</option>
                      <option value="POBLADORES">POBLADORES</option>
                      <option value="OTROS">OTROS</option>
                    </select>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Detalle</div>
                  <div class="item-input-wrap">
                    <input id="detallecoordinacion" name="detallecoordinacion" type="text" placeholder="Ingrese el detalle">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
            </ul>
          </div>
          
          <div class="block-title">OTRAS INCIDENCIAS SURGIDAS DURANTE LA ACTIVIDAD</div>
          <div class="list inset">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Incidencias</div>
                  <div class="item-input-wrap">
                    <input id="incidencias" name="incidencias" type="text" placeholder="Ingrese el detalle de incidencias">
                    <span class="input-clear-button"></span>
                  </div>
                </div>
              </li>
            </ul>
          </div>

        </form>
        <div class="list" style="padding: 20px;">
          <ul>
            <li>
              <a id="btnregistrar" @click="registraract" class="col button button-raised button-fill button-round">Registrar actividad</a>
            </li>
          </ul>
          <div class="block-footer">
  
          </div>
        </div>

      </div>
    </div>

  </div>
</template>
<script>
  import $ from "jquery";
  import {objectToString, StringToObject} from '../../helper';
  import {servers} from "../Login/servers";

  export default {
    created() {
    

    },
    on: {
      pageInit: function (event, page) {
        // llenar Horas
        for(var i = 0; i <= 23; i++) {
          var option = document.createElement('option');
          var option2 = document.createElement('option');
          option.textContent = (i < 10) ? ("0" + i) : i;
          option2.textContent = (i < 10) ? ("0" + i) : i;
          document.querySelector('#inicioacthora').appendChild(option);
          document.querySelector('#finacthora').appendChild(option2);
          
        }
        // llenar Minutos
        for(var i = 0; i <= 59; i++) {
          var option = document.createElement('option');
          var option2 = document.createElement('option');
          option.textContent = (i < 10) ? ("0" + i) : i;
          option2.textContent = (i < 10) ? ("0" + i) : i;
          document.querySelector('#inicioactminuto').appendChild(option);
          document.querySelector('#finactminuto').appendChild(option2);
        }

        let config;

        if(localStorage.usuariopersonal != undefined){
          config = JSON.parse(localStorage.usuariopersonal);
          $('#dni').val(config[0].dni);
          $('#nombre').val(config[0].nombres_apellidos);
        }

        var now = new Date();
        var day = ("0" + now.getDate()).slice(-2);
        var month = ("0" + (now.getMonth() + 1)).slice(-2);
        var today = now.getFullYear()+"-"+(month)+"-"+(day) ;
        $('#fecha').val(today);
        
      }
    },

    methods: {
      registraract() {
        const app = this.$app;
        const router = this.$router;
        
        let datos = {nombres:`${$('#nombre').val()}`,
                    dni:`${$('#dni').val()}`,
                    inicioactividades_area_estudio:`${$('#inicioacthora').val() + ':' + $('#inicioactminuto').val()}`,
                    termino_actividades_area_estudio:`${$('#finacthora').val() + ':' + $('#finactminuto').val()}`,
                    grupo_trabajo:`${$('#grupo_trabajo').val()}`,
                    fecha:`${$('#fecha').val()}`,
                    area_est_tramo:`${$('#tramo').val()}`,
                    area_est_sector:`${$('#sector').val()}`,
                    tipo_via:`${$('#tipovia').val()}`,
                    nombre:`${$('#nombrecalle').val()}`,
                    cuadras:`${$('#cuadras').val()}`,
                    referencia:`${$('#referencia').val()}`,
                    tipo_actividad:`${$('#tipoactividad').val()}`,
                    detalle_activ:`${$('#detalleact').val()}`,
                    equipo_utilizado:`${$('#equipo').val()}`,
                    //equipo_utilizado:`${$('#especificar').val()}`,
                    coordinaciones:`${$('#tipocoordinacion').val()}`,
                    //coordinaciones:`${$('#detallecoordinacion').val()}`,
                    otrasincidencias:`${$('#incidencias').val()}`
                    };

        let url_server = `http://${servers[2].ipServidor}:${servers[2].puertoServidor}/api`;

        $.post(`${url_server}/actividadcampo`, datos, function(data) { 
          if ($.isEmptyObject(data))
          {
            app.dialog.alert("Se encontró problema al registrar la actividad.");
          }
          else
          {
            let txtMensaje = `Su reporte ${data.id} fue enviado con éxito.`
            app.dialog.alert(txtMensaje, function () {
              router.navigate('/menu/', {pushState: true});
            });
          }
        })
        .fail(function() {
          app.dialog.alert( "Se encontró un problema en la conexión." );
        })
        .always(function() {
          
        });

      },

    }


  }
</script>
